<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>CKEditor iOS</title>
    <script src="https://cdn.ckeditor.com/ckeditor5/12.0.0/decoupled-document/ckeditor.js"></script>
    <meta charset="utf-8">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta name="viewport" content="width=device-width,initial-scale=1">
</head>

<style>
  html, body {
    -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
    margin: 0;
    padding: 0;
  }
  .ck-rounded-corners .ck.ck-editor__editable:not(.ck-editor__nested-editable), .ck.ck-editor__editable:not(.ck-editor__nested-editable).ck-rounded-corners {
    outline: none;
    border: 1px solid transparent;
    box-shadow: none;
  }
  .ck-rounded-corners .ck.ck-editor__editable:not(.ck-editor__nested-editable), .ck.ck-editor__editable:not(.ck-editor__nested-editable).ck-rounded-corners:focus {
    outline: none;
    border: 1px solid transparent;
    box-shadow: none;
  }
  .ck-rounded-corners .ck.ck-editor__editable:not(.ck-editor__nested-editable), .ck.ck-editor__editable:not(.ck-editor__nested-editable).ck-rounded-corners:active {
    outline: none;
    border: 1px solid transparent;
    box-shadow: none;
  }
  #editor {
    font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  }
  .text-big {
    font-size: 24px;
    font-weight: 600;
    line-height: 26px;
  }
  p {
    font-size: 16px;
    line-height: 24px;
    margin-bottom: 16px;
    margin-top: 0;
  }
</style>

<body>
<div name="content" id="editor"></div>
<script>
  window.addEventListener("message", function(event) {
    if (event.data.includes('placeholder: ')) {
      // Show inital content
      content = event.data.split('placeholder: ')[1];
      CKEditor.setData(content);
    } else if (event.data.includes('hidekeyboard: ')) {
      document.activeElement && document.activeElement.blur();
    } else {
      // Execute editor commands
      content = event.data.split('execute: ')[1];
      if (content === 'fontSize_big') {
        CKEditor.execute('fontSize', { value: 'big' });
      } else if (content === 'fontSize_normal') {
        CKEditor.execute('fontSize', { value: 'normal' });
      } else {
        CKEditor.execute(content);
      }
    }
  })

  DecoupledEditor
    .create(document.querySelector('#editor'), {
      placeholder: "Let your ideas flow. Type text, paste a link, add an image, video or audio",
      focus: true,
      fontFamily: {
        options: [
          'default',
          '-apple-system, BlinkMacSystemFont, sans-serif',
          'Arial, Helvetica, sans-serif'
        ]
      }
    })
    .then(editor => {
      window.CKEditor = editor;

      editor.model.document.on('change', function() {
        var value = document.getElementById('editor').textContent;
        var height = document.getElementById('editor').clientHeight;

        console.log("CKEditor - Value: ", value)
        console.log("CKEditor - height: ", height)
        if (value.length > 0) {
          window.postMessage('NO_KEYCODE>>>!hunt!<<<' + height + '>>>!hunt!<<<' + editor.getData(), '*')
        }
      });

      editor.editing.view.document.on('keydown', (data, evt) => {
        if (evt.keyCode === 13 || evt.keyCode === 32 || evt.keyCode === 188) {
          window.postMessage(evt.keyCode + '>>>!hunt!<<<', '*')
        }
      });
    })
    .catch(error => {
      console.error(error);
    });
</script>
</body>

</html>
